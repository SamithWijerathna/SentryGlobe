<!DOCTYPE html>

<html>

<head>

    <title>SSH Attack Monitor - 209.74.64.184</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/globe.gl@2.24.0/dist/globe.gl.min.js"></script>

    <style>

        body {

            margin: 0;

            font-family: 'Segoe UI', sans-serif;

            background-color: #0f0f1a;

            color: white;

        }

        #globe-container {

            width: 100%;

            height: 100vh;

        }

        #control-panel {

            position: absolute;

            top: 20px;

            right: 20px;

            background: rgba(0, 0, 30, 0.7);

            padding: 15px;

            border-radius: 8px;

            width: 300px;

            backdrop-filter: blur(5px);

            border: 1px solid #444;

        }

        #attack-log {

            max-height: 300px;

            overflow-y: auto;

            margin-top: 15px;

            background: rgba(0, 0, 0, 0.3);

            border-radius: 5px;

            padding: 10px;

        }

        .attack-entry {

            padding: 8px;

            margin: 5px 0;

            border-bottom: 1px solid #333;

            font-size: 12px;

        }

        .server-ip {

            color: #4af;

            font-weight: bold;

        }

    </style>

</head>

<body>

    <div id="globe-container"></div>



    <div id="control-panel">

        <h2>SSH Attack Monitor</h2>

        <p>Server: <span class="server-ip">209.74.64.184</span></p>

        <div id="stats">

            <p>Attacks (24h): <span id="attack-count">0</span></p>

            <p>Current Threats: <span id="active-threats">0</span></p>

        </div>



        <div id="attack-log">

            <h3>Recent Attacks</h3>

            <div id="attack-list"></div>

        </div>

    </div>



    <script>

(async function () {

    const attackHistory = [];

    const maxDisplayedAttacks = 50;



    // Create Globe

    const globe = Globe()

        .globeImageUrl('https://unpkg.com/three-globe/example/img/earth-dark.jpg')

        .bumpImageUrl('https://unpkg.com/three-globe/example/img/earth-topology.png')

        .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png')

        .showAtmosphere(true)

        .atmosphereColor('#3a228a')

        .atmosphereAltitude(0.15)

        .pointOfView({ lat: 0, lng: 0, altitude: 1.5 })

        .pointsMerge(true)

        .arcsTransitionDuration(1000)

        .arcDashLength(0.5)

        .arcDashGap(1)

        .arcDashInitialGap(() => Math.random())

        .arcDashAnimateTime(4000)

        .arcColor(() => ['#f00', '#ff0'])

        (document.getElementById('globe-container'));



    // Get server IP and geo location

    async function getServerLocation() {

        try {

            const ipRes = await fetch("https://api.ipify.org?format=json");

            const { ip } = await ipRes.json();



            const geoRes = await fetch(`https://ipapi.co/209.74.64.184/json/`);

            const geo = await geoRes.json();



            return {

                lat: geo.latitude,

                lng: geo.longitude,

                label: `Production Server (209.74.64.184)`

            };

        } catch (e) {

            console.error("Failed to fetch IP or location", e);

            return {

                lat: 6.9271,  // fallback: Colombo

                lng: 79.8612,

                label: 'Unknown Server Location'

            };

        }

    }



    const serverLocation = await getServerLocation();



    globe.pointOfView({ lat: serverLocation.lat, lng: serverLocation.lng, altitude: 1.5 });



    globe.pointsData([{

        lat: serverLocation.lat,

        lng: serverLocation.lng,

        size: 15,

        color: 'cyan',

        label: serverLocation.label

    }]);



    // Live data handling

    function processAttack(attack) {

        attackHistory.push(attack);



        if (attackHistory.length > maxDisplayedAttacks) {

            attackHistory.shift();

        }



        globe

            .pointsData([

                ...attackHistory.map(a => ({

                    lat: a.lat,

                    lng: a.lng,

                    size: 8,

                    color: 'red',

                    label: `${a.ip} (${a.country})`

                })),

                {

                    lat: serverLocation.lat,

                    lng: serverLocation.lng,

                    size: 15,

                    color: 'cyan',

                    label: serverLocation.label

                }

            ])

            .arcsData(attackHistory.map(a => ({

                startLat: a.lat,

                startLng: a.lng,

                endLat: serverLocation.lat,

                endLng: serverLocation.lng,

                color: ['red', 'yellow'],

                label: `Attack from ${a.country}`

            })));



        // Update UI

        document.getElementById('attack-count').textContent = attackHistory.length;

        document.getElementById('active-threats').textContent = attackHistory.length;



        const logEntry = document.createElement('div');

        logEntry.className = 'attack-entry';

        logEntry.innerHTML = `

            <strong>${new Date(attack.timestamp).toLocaleTimeString()}</strong><br>

            ${attack.ip} (${attack.country})<br>

            ${attack.event}

        `;

        const list = document.getElementById('attack-list');

        list.prepend(logEntry);

        if (list.children.length > 10) {

            list.removeChild(list.lastChild);

        }

    }



    // Load history

    fetch('http://209.74.64.184:5000/api/history')

        .then(res => res.json())

        .then(data => data.forEach(processAttack))

        .catch(err => console.error("History load failed:", err));



    // Real-time updates

    const eventSource = new EventSource('http://209.74.64.184:5000/api/ssh-stream');

    eventSource.onmessage = (e) => {

        try {

            const attack = JSON.parse(e.data);

            processAttack(attack);

        } catch (err) {

            console.warn('Invalid SSE data', err);

        }

    };

})();

</script>





</body>

</html>
